name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: Verify Python scripts import
        run: |
          python - << 'PY'
          import importlib.util
          import sys
          for f in [
            'src/data_processor.py',
            'models/arima_model.py',
            'models/deepar_model.py',
            'models/lstm_model.py'
          ]:
              spec = importlib.util.spec_from_file_location('m', f)
              m = importlib.util.module_from_spec(spec)
              spec.loader.exec_module(m)
              print('Imported', f)
          PY

      - name: Set up Bun
        uses: oven-sh/setup-bun@v1

      - name: Install Node dependencies
        run: |
          if [ -f package.json ]; then bun install; fi

      - name: Type-check index.ts
        run: |
          if [ -f tsconfig.json ]; then bun x tsc --noEmit; fi


